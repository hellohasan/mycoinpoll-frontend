{"file":"useWeb3-BYnZ8Zbm.js","mappings":"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","names":["piniaPluginPersistedstate"],"sources":["../../../../stores/useUserTokenStore.js","../../../../composables/useAuthHelper.ts","../../../../composables/useWeb3.ts"],"sourcesContent":["import { defineStore } from \"pinia\";\n\nconst EXPIRATION_TIME = 3 * 60 * 1000; // 5 minutes\n\nexport const useUserTokenStore = defineStore(\"userToken\", {\n  state: () => ({\n    tokens: [],\n    isLoading: false,\n    error: null,\n    expirationTime: null,\n  }),\n\n  getters: {\n    getTokenById: (state) => (id) => state.tokens.find((token) => token.id === id),\n\n    isDataExpired: (state) => {\n      return !state.expirationTime || Date.now() >= state.expirationTime;\n    },\n\n    userETHAddress() {\n      const authStore = useAuthStore();\n      return authStore.user?.eth_address || \"\";\n    },\n  },\n\n  actions: {\n    async fetchFeatureTokens() {\n      if (!this.isDataExpired) return;\n      const { myFetch } = useApi();\n      this.isLoading = true;\n      this.error = null;\n\n      try {\n        const config = useRuntimeConfig();\n        const data = await myFetch(`${config.public.apiBase}/feature-tokens`);\n        const tokensWithBalances = await Promise.all(\n          data.map(async (token) => {\n            const balance = await this.fetchTokenBalance(token);\n            return {\n              ...token,\n              balance,\n            };\n          })\n        );\n        this.tokens = tokensWithBalances;\n        this.setExpirationTime();\n      } catch (error) {\n        this.error = \"Failed to fetch feature tokens\";\n      } finally {\n        this.isLoading = false;\n      }\n    },\n\n    async fetchTokenBalance(token) {\n      if (!this.userETHAddress) return 0;\n      if (token.contract_address == null) return 0;\n      const { myFetch } = useApi();\n      try {\n        const data = await myFetch(`token-balance/${token.contract_address}/${this.userETHAddress}`);\n        return data.balance;\n      } catch (error) {}\n    },\n\n    setExpirationTime() {\n      this.expirationTime = Date.now() + EXPIRATION_TIME;\n    },\n\n    resetIfExpired() {\n      if (this.isDataExpired) {\n        this.tokens = [];\n        this.expirationTime = null;\n        this.fetchFeatureTokens();\n      }\n    },\n  },\n\n  persist: {\n    storage: piniaPluginPersistedstate.localStorage(),\n    beforeRestore: (context) => {\n      context.store.resetIfExpired();\n    },\n  },\n});\n","export const useAuthHelper = () => {\n  const router = useRouter();\n  const { authenticated } = useAuthStore();\n  const { disconnect } = useWeb3();\n  const { useOnlyFetch } = useApi();\n\n  const logout = async () => {\n    if (authenticated) {\n      await useOnlyFetch(\"/auth/logout\", { method: \"POST\" });\n      useAuthStore().$reset();\n      useUserTokenStore().$reset();\n      await disconnect();\n      useCookie(\"authentication\").value = null;\n      router.push(\"/auth/login\");\n    }\n  };\n\n  return {\n    logout,\n  };\n};\n","import { useNuxtApp } from \"#app\";\nimport { useAppKit, useDisconnect } from \"@reown/appkit/vue\";\nimport SaleContractABI from \"~/abi/SaleContractABI.json\";\nimport ECMContractABI from \"~/abi/ECMContractABI.json\";\nimport ECMStakingContractABI from \"~/abi/ECMStakingContractABI.json\";\nimport IERC20ABI from \"~/abi/IERC20ABI.json\";\n\nexport const useWeb3 = () => {\n  const config = useRuntimeConfig();\n\n  const modal = computed(() => {\n    if (!process.client) return null;\n    return useAppKit();\n  });\n\n  const { disconnect } = useDisconnect();\n\n  const myDisconnect = async (shouldLogout = true) => {\n    const { logout } = useAuthHelper();\n    disconnect();\n    if (shouldLogout) {\n      await logout();\n    }\n  };\n\n  return {\n    modal: modal.value,\n    disconnect,\n    myDisconnect,\n    SaleContractABI,\n    ECMContractABI,\n    ECMStakingContractABI,\n    IERC20ABI,\n    alchemyLink: config.public.alchemyLink,\n    SaleAddress: config.public.tokenSaleAddress,\n    TokenAddress: config.public.tokenAddress,\n    USDTAddress: config.public.usdtAddress,\n    StakingAddress: config.public.StakingAddress,\n  };\n};\n"],"version":3}