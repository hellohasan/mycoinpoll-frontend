import{_ as B}from"./ub6kuCb3.js";import{_ as L}from"./BWLN8O8p.js";import{U as M,Q as j,r as _,c as m,a as o,e as D,g as w,b as v,f as C,v as k,u as e,n as f,w as $,d as l,F as x,t as q,W as R,X as I,i as P,o as p}from"./--rz71Vb.js";import{u as A}from"./-HW9Rane.js";import{u as K,a as O}from"./DNC11X57.js";import{u as z}from"./0rbwi0QL.js";import{u as G}from"./CFwKkAp4.js";import"./CjliaLmw.js";function H(){const g=M(),c=t=>t.startsWith("/sanctum/csrf-cookie")?g.public.apiBase.replace(/\/api\/v\d+$/,"")+t:g.public.apiBase+t;return{getCsrfToken:async()=>{try{const t=c("/sanctum/csrf-cookie");await $fetch(t)}catch{throw new Error("CSRF token fetch failed")}}}}const Q={class:"coin-details-hero-bg position-relative coin-details-hero-border custom-container"},X={class:"login-form ptb80"},Y={class:"modal-custom-width page-modal-width"},J={class:"modal-content custom-modal"},Z={class:"modal-body-inner"},ss={class:"row gy-3"},os={class:"form-group col-md-12"},es={class:"input bg-border-input d-flex align-items-center"},ts={class:"form-group col-md-12"},rs={class:"input bg-border-input"},ns={class:"form-group col-md-12 d-flex align-items-center justify-content-between flex-wrap"},as={class:"form-group col-md-12"},is=["disabled"],ls={class:"form-group col-md-12 m-0"},ds=["disabled"],cs={key:0,class:"form-group col-md-12"},ys={__name:"login",setup(g){const c=j(),{toastSuccess:b}=A(),t=K(),{modal:S,disconnect:y}=O(),d=_(!1),T=_("Connect Wallet"),{toastError:W}=A(),{getCsrfToken:h}=H(),r=z({username:"",password:""}),E=async()=>{await h(),await r.submit("/auth/login").then(async n=>{c.loginAction(n),b("Login successfully Completed."),P("/dashboard")}).catch(n=>{})},F=n=>["Welcome to MyCoinPoll!","","Signing confirms wallet ownership and agreement to our terms. No transaction or fees involvedâ€”authentication only.","",`Wallet: ${n}`,"","Thank you for being a part of our community!"].join(`
`),{myFetch:N}=G(),U=async()=>{if(d.value=!0,!t.value.isConnected){S.open(),d.value=!1;return}try{const{walletProvider:n}=R("eip155"),a=await new I(n).getSigner();if(!a)throw new Error("No signer available");const u=F(a.address),i=await a.signMessage(u);await h();const V=await N("/auth/web3-login",{method:"POST",body:{message:u,address:a.address,signature:i}});c.loginAction(V),b("Login successfully completed"),P("/dashboard")}catch(n){const s={"No signer available":"Please check your wallet connection.","User rejected request":"You declined the signature request."}[n.message]||"An unexpected error occurred. Please try again.";W(s)}finally{d.value=!1}};return(n,s)=>{const a=B,u=L;return p(),m("div",Q,[o("div",X,[o("div",Y,[o("div",J,[o("form",{onSubmit:D(E,["prevent"])},[s[14]||(s[14]=o("div",{class:"modal-header-area d-flex align-items-center justify-content-between"},[o("h4",{class:"text-shadow"},"Log In")],-1)),o("div",Z,[o("div",ss,[o("div",os,[s[3]||(s[3]=o("label",{for:"username"},"Email or Username",-1)),o("div",es,[C(o("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>e(r).username=i),type:"text",class:f(["form-control",{"is-invalid":e(r).errors.has("username")}]),id:"username",placeholder:"Enter email or username or Unique ID"},null,2),[[k,e(r).username]])]),v(a,{form:e(r),field:"username"},null,8,["form"])]),o("div",ts,[s[4]||(s[4]=o("label",{for:"password"},"Password",-1)),o("div",rs,[C(o("input",{"onUpdate:modelValue":s[1]||(s[1]=i=>e(r).password=i),type:"password",class:f([{"is-invalid":e(r).errors.has("password")},"form-control"]),id:"password",placeholder:"Enter valid password"},null,2),[[k,e(r).password]])]),v(a,{form:e(r),field:"password"},null,8,["form"])]),o("div",ns,[v(u,{to:"/auth/forgot-password",class:"gradient-color"},{default:$(()=>s[5]||(s[5]=[l("Forgot Password?")])),_:1})]),o("div",as,[o("button",{type:"submit",disabled:e(r).busy,class:"btn1 primary-btn subscribe-btn w-100"},[e(r).busy?(p(),m(x,{key:0},[s[6]||(s[6]=o("i",{class:"fas fa-spinner fa-spin me-1"},null,-1)),s[7]||(s[7]=l(" Processing for "))],64)):w("",!0),s[8]||(s[8]=l(" Login Now ")),s[9]||(s[9]=o("span",{class:"icon-rotate"},[o("i",{class:"fas fa-arrow-right"})],-1))],8,is)]),s[13]||(s[13]=o("div",{class:"d-flex justify-content-center mt-20 mb20"},[o("p",{class:"modal-or-divider or-divider w-80"},"OR")],-1)),o("div",ls,[o("button",{type:"button",disabled:e(d),onClick:U,class:"btn1 primary-btn subscribe-btn w-100"},[e(d)?(p(),m(x,{key:0},[s[10]||(s[10]=o("i",{class:"fas fa-spinner fa-spin me-1"},null,-1)),s[11]||(s[11]=l(" Processing for "))],64)):w("",!0),l(" "+q(e(T))+" ",1),o("span",{class:f({"icon-rotate":e(t).isConnected})},[o("i",{class:f(["fa-solid",e(t).isConnected?"fa-arrow-right":"fa-wallet"])},null,2)],2)],8,ds)]),e(t).isConnected?(p(),m("div",cs,[o("button",{type:"button",onClick:s[2]||(s[2]=(...i)=>e(y)&&e(y)(...i)),class:"btn1 primary-btn subscribe-btn w-100"},s[12]||(s[12]=[l(" Disconnect Wallet "),o("span",{class:"icon-rotate"},[o("i",{class:"fas fa-unlink"})],-1)]))])):w("",!0)])])],32)])])])])}}};export{ys as default};
