import{u as j,_ as B}from"./BdcTORzl.js";import{_ as L}from"./B-5VvPcr.js";import{D as U,j as D,r as _,c as m,a as o,e as $,g as w,b as v,f as C,v as k,u as e,n as f,w as q,d as l,F as x,t as R,P as I,Q as K,i as P,o as p}from"./6IpCoGFE.js";import{u as T}from"./GevnLgCi.js";import{u as O,a as z}from"./DPzlc_os.js";import{u as G}from"./C1w8izk3.js";import"./CefQi9ay.js";import"./CaNsbxwq.js";function H(){const g=U(),c=t=>t.startsWith("/sanctum/csrf-cookie")?g.public.apiBase.replace(/\/api\/v\d+$/,"")+t:g.public.apiBase+t;return{getCsrfToken:async()=>{try{const t=c("/sanctum/csrf-cookie");await $fetch(t)}catch{throw new Error("CSRF token fetch failed")}}}}const Q={class:"coin-details-hero-bg position-relative coin-details-hero-border custom-container"},Y={class:"login-form ptb80"},J={class:"modal-custom-width page-modal-width"},X={class:"modal-content custom-modal"},Z={class:"modal-body-inner"},ss={class:"row gy-3"},os={class:"form-group col-md-12"},es={class:"input bg-border-input"},ts={class:"form-group col-md-12"},rs={class:"input bg-border-input"},as={class:"form-group col-md-12 d-flex align-items-center justify-content-between flex-wrap"},ns={class:"form-group col-md-12"},is=["disabled"],ls={class:"form-group col-md-12 m-0"},ds=["disabled"],cs={key:0,class:"form-group col-md-12"},ys={__name:"login",setup(g){const{loginAction:c}=D(),{toastSuccess:b}=T(),t=O(),{modal:A,disconnect:y}=z(),d=_(!1),S=_("Connect Wallet"),{toastError:E}=T(),{getCsrfToken:h}=H(),r=j({username:"",password:""}),F=async()=>{await h(),await r.submit("/auth/login").then(async a=>{await c(a),b("Login successfully Completed."),P("/dashboard")}).catch(a=>{})},N=a=>["Welcome to MyCoinPoll!","","Signing confirms wallet ownership and agreement to our terms. No transaction or fees involvedâ€”authentication only.","",`Wallet: ${a}`,"","Thank you for being a part of our community!"].join(`
`),{useMyFetch:W}=G(),M=async()=>{if(d.value=!0,!t.value.isConnected){A.open(),d.value=!1;return}try{const{walletProvider:a}=I("eip155"),n=await new K(a).getSigner();if(!n)throw new Error("No signer available");const u=N(n.address),i=await n.signMessage(u);await h();const{data:V}=await W("/auth/web3-login",{method:"POST",server:!1,body:{message:u,address:n.address,signature:i}});await c(V.value),b("Login successfully completed"),await P("/dashboard")}catch(a){const s={"No signer available":"Please check your wallet connection.","User rejected request":"You declined the signature request."}[a.message]||"An unexpected error occurred. Please try again.";E(s)}finally{d.value=!1}};return(a,s)=>{const n=B,u=L;return p(),m("div",Q,[o("div",Y,[o("div",J,[o("div",X,[o("form",{onSubmit:$(F,["prevent"])},[s[14]||(s[14]=o("div",{class:"modal-header-area d-flex align-items-center justify-content-between"},[o("h4",{class:"text-shadow"},"Log In")],-1)),o("div",Z,[o("div",ss,[o("div",os,[s[3]||(s[3]=o("label",{for:"username"},"Email or Username",-1)),o("div",es,[C(o("input",{"onUpdate:modelValue":s[0]||(s[0]=i=>e(r).username=i),type:"text",class:f(["form-control",{"is-invalid":e(r).errors.has("username")}]),id:"username",placeholder:"Enter email or username or Unique ID"},null,2),[[k,e(r).username]])]),v(n,{form:e(r),field:"username"},null,8,["form"])]),o("div",ts,[s[4]||(s[4]=o("label",{for:"password"},"Password",-1)),o("div",rs,[C(o("input",{"onUpdate:modelValue":s[1]||(s[1]=i=>e(r).password=i),type:"password",class:f([{"is-invalid":e(r).errors.has("password")},"form-control"]),id:"password",placeholder:"Enter valid password"},null,2),[[k,e(r).password]])]),v(n,{form:e(r),field:"password"},null,8,["form"])]),o("div",as,[v(u,{to:"/auth/forgot-password",class:"gradient-color"},{default:q(()=>s[5]||(s[5]=[l("Forgot Password?")])),_:1})]),o("div",ns,[o("button",{type:"submit",disabled:e(r).busy,class:"btn1 primary-btn subscribe-btn w-100"},[e(r).busy?(p(),m(x,{key:0},[s[6]||(s[6]=o("i",{class:"fas fa-spinner fa-spin me-1"},null,-1)),s[7]||(s[7]=l(" Processing for "))],64)):w("",!0),s[8]||(s[8]=l(" Login Now ")),s[9]||(s[9]=o("span",{class:"icon-rotate"},[o("i",{class:"fas fa-arrow-right"})],-1))],8,is)]),s[13]||(s[13]=o("div",{class:"d-flex justify-content-center mt-20 mb20"},[o("p",{class:"modal-or-divider or-divider w-80"},"OR")],-1)),o("div",ls,[o("button",{type:"button",disabled:e(d),onClick:M,class:"btn1 primary-btn subscribe-btn w-100"},[e(d)?(p(),m(x,{key:0},[s[10]||(s[10]=o("i",{class:"fas fa-spinner fa-spin me-1"},null,-1)),s[11]||(s[11]=l(" Processing for "))],64)):w("",!0),l(" "+R(e(S))+" ",1),o("span",{class:f({"icon-rotate":e(t).isConnected})},[o("i",{class:f(["fa-solid",e(t).isConnected?"fa-arrow-right":"fa-wallet"])},null,2)],2)],8,ds)]),e(t).isConnected?(p(),m("div",cs,[o("button",{type:"button",onClick:s[2]||(s[2]=(...i)=>e(y)&&e(y)(...i)),class:"btn1 primary-btn subscribe-btn w-100"},s[12]||(s[12]=[l(" Disconnect Wallet "),o("span",{class:"icon-rotate"},[o("i",{class:"fas fa-unlink"})],-1)]))])):w("",!0)])])],32)])])])])}}};export{ys as default};
