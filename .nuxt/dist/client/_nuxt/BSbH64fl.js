import{_ as re}from"./PLJPPlAC.js";import{_ as de}from"./BWLN8O8p.js";import{_ as ce}from"./BD6EIDbc.js";import{_ as ue,r as c,k as O,h as pe,c0 as ge,c as p,a as e,g as R,b as y,f as N,v as fe,u as o,A as ve,d as g,t as a,F as W,l as K,e as q,bZ as X,w as T,q as me,W as Y,X as Z,cw as I,cx as G,o as u,p as _e,cy as he,cz as B}from"./--rz71Vb.js";import{i as be}from"./C-jW0EVW.js";import{u as we,a as U}from"./DNC11X57.js";import{u as ke}from"./CFwKkAp4.js";import{u as ye}from"./-HW9Rane.js";import"./CjliaLmw.js";const xe={class:"dashboard-body mt30"},Ce={class:"staking-section"},Se={class:"row"},Me={class:"col-md-12"},Ee={action:""},Ae={class:"d-flex h-100 justify-content-between g-20 flex-xl-nowrap flex-wrap"},Pe={class:"staking-header-item"},De={class:"taking-value-area d-flex align-items-center g-10 justify-content-between"},je={class:"staking-value d-flex align-items-center g-10"},Fe={class:"balance"},$e={class:"d-flex align-items-center mt-3 g-20 flex-wrap"},Ne={class:"form-group"},Te={class:"staking-days-select-btn bg-border-input"},Ie={class:"form-group"},Be={class:"bg-border-input staking-days-select-btn"},Ue={class:"form-group"},Ve={class:"bg-border-input staking-days-select-btn"},He={class:"form-group"},Le={class:"bg-border-input staking-days-select-btn"},ze={class:"staking-header-item"},Oe={class:"taking-value-area d-flex align-items-center g-10 justify-content-between"},Re={class:"staking-value d-flex align-items-center g-10"},We={class:"d-flex align-items-center mt-3 g-20 flex-wrap"},Ke={class:"bg-border-input staking-days-select-btn"},qe=["id","value","onChange"],Xe=["for"],Ye={class:"lock-overview d-flex align-items-center justify-content-center mt-2"},Ze={class:"selected-staking-title d-flex align-items-center g-10"},Ge={class:"page-title"},Je={class:"d-flex align-items-center justify-content-between flex-wrap flex-md-nowrap g-10 mt-4"},Qe={class:"milestone-offer-card w-100"},et={class:"milestone-offer-info-item d-flex align-items-center justify-content-between"},tt={class:"milestone-offer-info-item d-flex align-items-center justify-content-between"},st={class:"text-color-1CD691"},at={class:"milestone-offer-info-item d-flex align-items-center justify-content-between"},nt={class:"milestone-offer-card w-100"},ot={class:"milestone-offer-info-item d-flex align-items-center justify-content-between"},lt={class:"milestone-offer-info-item d-flex align-items-center justify-content-between"},it={class:"text-color-1CD691"},rt={class:"milestone-offer-info-item d-flex align-items-center justify-content-between"},dt={class:"d-flex align-items-center justify-content-md-between justify-content-center flex-wrap flex-md-nowrap g-10 mt-4"},ct=["disabled"],ut={class:"fa fa-spinner fa-spin me-1"},pt={class:"icon-rotate"},gt={key:0,class:"w-100 mt-4"},ft=["href"],vt={class:"clip-text w-auto"},mt={class:"data-show-table-area dashboard-box mt30"},_t={key:0,class:"common-table mt30"},ht={class:"custom-table display nowrap mobile-table"},bt={class:"text-start"},wt={key:1,class:"completed-status badge"},kt=["onClick"],yt={__name:"staking",async setup(xt){let f,x;const D=we(),{modal:J}=U(),C=c(0),l=c(0),d=c(0),b=c(0),j=c(0),S=c(0),M=c(0),E=c(null),{useOnlyFetch:F}=ke(),{data:Q}=([f,x]=O(()=>F("/get-staking-plans")),f=await f,x(),f),{data:ee,pending:te,refresh:Ct}=([f,x]=O(()=>F("/get-staking-history")),f=await f,x(),f),A=s=>{const t=parseInt(s.target.value),i=parseFloat(C.value);switch(t){case 1:l.value=(i*.25).toFixed(4);break;case 2:l.value=(i*.5).toFixed(4);break;case 3:l.value=(i*.75).toFixed(4);break;case 4:l.value=i.toFixed(4);break}},se=s=>{d.value=parseInt(s.duration),b.value=parseInt(s.reward_percentage),j.value=parseInt(s.id-1)},V=async()=>{if(D.value.isConnected){const{walletProvider:s}=Y("eip155"),i=await new Z(s).getSigner(),{ECMContractABI:h,TokenAddress:v}=U(),r=await new I(v,h,i).balanceOf(D.value.address);C.value=Number(parseFloat(G(r)).toFixed(4))}return 0};pe(async()=>{await V()});const ae=()=>{if(!d.value)return"-";const s=new Date;s.setDate(s.getDate()+d.value);const t=s.getDate(),i=s.toLocaleString("en-US",{month:"long"}),h=s.getFullYear(),v=s.getHours()%12||12,n=s.getMinutes().toString().padStart(2,"0"),r=s.getHours()>=12?"PM":"AM",m=["th","st","nd","rd"][t%10>3?0:(t%100-t%10!=10)*(t%10)];return`${t}${m}, ${i} ${h} ${v}:${n} ${r}`};ge([l,b,d],()=>{if(l.value>0&&d.value>0&&b.value>0){const s=parseFloat(l.value)*b.value/100;S.value=Number(s.toFixed(3)),M.value=Number((parseFloat(l.value)+s).toFixed(3))}else S.value=0,M.value=0},{immediate:!0});const w=c("Stake Now"),k=c(!1),{toastError:H,toastSuccess:ne}=ye(),oe=async()=>{if(D.value.isConnected)if(l.value>0&&d.value>0&&b.value>0)try{k.value=!0,w.value="Wallet Connecting...";const{walletProvider:s}=Y("eip155"),i=await new Z(s).getSigner(),{ECMStakingContractABI:h,StakingAddress:v,ECMContractABI:n,TokenAddress:r}=U(),m=he(l.value,18),$=new I(r,n,i);w.value="Approving Stake Amount",await(await $.approve(v,m)).wait(),w.value="Staking on Processing...";const P=new I(v,h,i),z=await(await P.stake(m,j.value)).wait();E.value=z.hash,w.value="Staking Done!",await V(),z.logs.forEach(async le=>{const _=P.interface.parseLog(le);if((_==null?void 0:_.name)==="Staked"){const ie={staker:_.args[0],stakeId:B(_.args[1],0),amount:G(_.args[2]),planIndex:B(_.args[3],0),endTime:B(_.args[4],0)};await F("staking-created",{method:"POST",body:ie})}}),ne("Staking successfully Done!")}catch(s){const t=s.shortMessage?s.shortMessage.charAt(0).toUpperCase()+s.shortMessage.slice(1):s.message||"Unknown error occurred";H(t)}finally{k.value=!1,w.value="Stake Now",C.value=0,l.value=0,d.value=0,b.value=0,j.value=0,S.value=0,M.value=0}else H("Please enter amount and select a plan");else J.open()};return(s,t)=>{const i=re,h=de,v=ce;return u(),p("div",xe,[e("div",Ce,[e("div",Se,[e("div",Me,[e("form",Ee,[e("div",Ae,[e("div",Pe,[e("div",De,[e("div",je,[y(i,{src:"/images/icon/ecm.png",loading:"lazy",placeholder:"","placeholder-class":"rounded-circle",alt:"ecm-logo"}),N(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>ve(l)?l.value=n:null),placeholder:"Enter ECM amount"},null,512),[[fe,o(l)]])]),e("div",Fe,[t[2]||(t[2]=e("p",null,"Balance",-1)),e("p",null,[e("span",null,a(o(C)),1),t[1]||(t[1]=g(" ECM "))])])]),e("div",$e,[e("div",Ne,[e("div",Te,[e("input",{type:"radio",id:"one",class:"public-radio",onChange:A,name:"stakingPercentage",value:"1"},null,32),t[3]||(t[3]=e("label",{for:"one"},[g(" 25% "),e("span")],-1))])]),e("div",Ie,[e("div",Be,[e("input",{type:"radio",id:"two",class:"public-radio",onChange:A,name:"stakingPercentage",value:"2"},null,32),t[4]||(t[4]=e("label",{for:"two"},[g(" 50% "),e("span")],-1))])]),e("div",Ue,[e("div",Ve,[e("input",{type:"radio",id:"three",class:"public-radio",onChange:A,name:"stakingPercentage",value:"3"},null,32),t[5]||(t[5]=e("label",{for:"three"},[g(" 75% "),e("span")],-1))])]),e("div",He,[e("div",Le,[e("input",{type:"radio",id:"four",class:"public-radio",onChange:A,name:"stakingPercentage",value:"4"},null,32),t[6]||(t[6]=e("label",{for:"four"},[g(" Max "),e("span")],-1))])])])]),e("div",ze,[e("div",Oe,[e("div",Re,[y(i,{src:"/images/icon/timer.png",loading:"lazy",placeholder:"","placeholder-class":"rounded-circle",alt:"timer"}),e("p",null,a(o(d)),1)]),t[7]||(t[7]=e("div",{class:"days-value"},[e("p",null,"Days")],-1))]),e("div",We,[(u(!0),p(W,null,K(o(Q),(n,r)=>(u(),p("div",{key:r,class:"form-group"},[e("div",Ke,[e("input",{type:"radio",id:`stakingweek_${r+1}`,value:n.duration,onChange:m=>se(n),class:"public-radio",name:"stakingweek"},null,40,qe),e("label",{for:`stakingweek_${r+1}`},[g(a(n.name)+" ",1),t[8]||(t[8]=e("span",null,null,-1))],8,Xe)])]))),128))])])]),t[19]||(t[19]=e("div",{class:"mt-4"},[e("span",{class:"label"},"Lock Overview")],-1)),e("div",Ye,[e("div",Ze,[y(i,{src:"/images/icon/ecm.png",width:"30",loading:"lazy",placeholder:"","placeholder-class":"rounded-circle",alt:"icon"}),e("h6",Ge,"My "+a(o(l))+" ECM Stack for "+a(o(d))+" Days",1)])]),e("div",Je,[e("div",Qe,[e("div",et,[t[9]||(t[9]=e("p",null,"Stack amount",-1)),e("span",null,a(o(l))+" ECM",1)]),e("div",tt,[t[10]||(t[10]=e("p",null,"Estimated Profit",-1)),e("span",st,a(o(S))+" ECM",1)]),e("div",at,[t[11]||(t[11]=e("p",null,"Total with Reward",-1)),e("span",null,a(o(M))+" ECM",1)])]),e("div",nt,[e("div",ot,[t[12]||(t[12]=e("p",null,"ECM to be locked",-1)),e("span",null,a(o(l))+" ECM",1)]),e("div",lt,[t[13]||(t[13]=e("p",null,"Duration",-1)),e("span",it,a(o(d))+" days",1)]),e("div",rt,[t[14]||(t[14]=e("p",null,"Unlocked on",-1)),e("span",null,a(ae()),1)])])]),e("div",dt,[e("button",{type:"button",disabled:o(k),onClick:q(oe,["prevent"]),class:"gradient-btn w-50"},[N(e("i",ut,null,512),[[X,o(k)]]),g(" "+a(o(w))+" ",1),N(e("span",pt,t[15]||(t[15]=[e("i",{class:"fas fa-arrow-right"},null,-1)]),512),[[X,!o(k)]])],8,ct),y(h,{to:{name:"dashboard-ico"},class:"transparent-btn border-gradient w-50"},{default:T(()=>t[16]||(t[16]=[g(" Buy ECM "),e("i",{class:"fa-solid fa-cart-shopping"},null,-1)])),_:1})]),o(E)?(u(),p("div",gt,[e("a",{href:`https://etherscan.io/tx/${o(E)}`,target:"_blank",class:"transparent-btn border-gradient d-flex align-items-center justify-content-center g-10"},[t[17]||(t[17]=e("span",null,[e("b",null,"Hash :")],-1)),e("span",vt,a(o(E)),1),t[18]||(t[18]=e("span",{class:"text-copy-btn rotate-50"},[e("i",{class:"fa-solid fa-arrow-right-long"})],-1))],8,ft)])):R("",!0)])])])]),e("div",mt,[t[21]||(t[21]=me('<div class="table-header-area d-flex align-items-center justify-content-between" data-v-efd39d73><div class="table-heading" data-v-efd39d73><h5 data-v-efd39d73>Staking History</h5></div><div class="search-box-area" data-v-efd39d73><form action="" data-v-efd39d73><div class="input bg-border-input position-relative" data-v-efd39d73><div class="search-icon" data-v-efd39d73><i class="search-icon fas fa-search" data-v-efd39d73></i></div><input type="text" class="form-control" id="search" placeholder="Search here..." data-v-efd39d73></div></form></div></div>',1)),y(v,null,{default:T(()=>[o(te)?R("",!0):(u(),p("div",_t,[e("table",ht,[t[20]||(t[20]=e("thead",null,[e("tr",null,[e("th",null,"SL"),e("th",null,"Date"),e("th",null,"Amount"),e("th",null,"Percentage"),e("th",null,"Duration"),e("th",null,"Reward"),e("th",null,"Total Receive"),e("th",null,"Status")])],-1)),e("tbody",null,[(u(!0),p(W,null,K(o(ee),(n,r)=>(u(),p("tr",{key:r},[e("td",null,a(r+1),1),e("td",null,a(n.created_at_formatted),1),e("td",null,a(n.amount)+" ECM",1),e("td",null,a(n.percentage)+"%",1),e("td",null,a(n.duration)+" day",1),e("td",null,a(n.reward)+" ECM",1),e("td",null,a(n.total_receive)+" ECM",1),e("td",bt,[n.status==="pending"?(u(),_e(o(be),{key:0,time:n.remaining_time*1e3},{default:T(({days:m,hours:$,minutes:L,seconds:P})=>[g(a(m)+"d:"+a($)+"h:"+a(L)+"m:"+a(P)+"s",1)]),_:2},1032,["time"])):n.status==="completed"?(u(),p("span",wt,"Completed")):(u(),p("a",{key:2,href:"#",onClick:q(m=>s.unstake(n.id),["prevent"]),class:"gradient-btn-small bg-red"},"Unstake Now",8,kt))])]))),128))])])]))]),_:1})])])}}},Tt=ue(yt,[["__scopeId","data-v-efd39d73"]]);export{Tt as default};
