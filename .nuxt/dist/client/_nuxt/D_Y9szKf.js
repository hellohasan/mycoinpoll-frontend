import{u as W,_ as j}from"./CXTrl4Sf.js";import{_ as L}from"./CGAsMNWB.js";import{h as M,r as y,c,a as o,e as B,g as f,b as g,f as h,v as _,u as e,n as m,w as U,d as i,F as x,t as D,i as q,B as I,j as P,o as p}from"./BtVSoYiO.js";import{u as C}from"./B22M1GYj.js";import{u as K,a as O}from"./BYXUraVX.js";import{u as $}from"./tmZZAqbx.js";import"./CulzKhVF.js";import"./Cd7iz5iy.js";const z={class:"coin-details-hero-bg position-relative coin-details-hero-border custom-container"},G={class:"login-form ptb80"},H={class:"modal-custom-width page-modal-width"},R={class:"modal-content custom-modal"},Y={class:"modal-body-inner"},J={class:"row gy-3"},Q={class:"form-group col-md-12"},X={class:"input bg-border-input"},Z={class:"form-group col-md-12"},ss={class:"input bg-border-input"},os={class:"form-group col-md-12 d-flex align-items-center justify-content-between flex-wrap"},es={class:"form-group col-md-12"},ts=["disabled"],rs={class:"form-group col-md-12 m-0"},ns=["disabled"],as={key:0,class:"form-group col-md-12"},ws={__name:"login",setup(is){const{loginAction:b}=M(),{toastSuccess:w}=C(),d=K(),{modal:k,disconnect:v}=O(),l=y(!1),A=y("Connect Wallet"),{toastError:N}=C(),S=$(),t=W({username:"",password:""}),E=async()=>{await t.submit("/auth/login").then(async r=>{await b(r),w("Login successfully Completed."),P("/dashboard")}).catch(r=>{})},F=r=>["Welcome to MyCoinPoll!","","Signing confirms wallet ownership and agreement to our terms. No transaction or fees involvedâ€”authentication only.","",`Wallet: ${r}`,"","Thank you for being a part of our community!"].join(`
`),T=async()=>{if(l.value=!0,!d.value.isConnected){k.open(),l.value=!1;return}try{const{walletProvider:r}=q("eip155"),n=await new I(r).getSigner();if(!n)throw new Error("No signer available");const u=F(n.address),a=await n.signMessage(u),{data:V,error:ls}=await S.useFetch("/auth/web3-login",{method:"POST",body:{message:u,address:n.address,signature:a}});await b(V.value),w("Login successfully completed"),await P("/dashboard")}catch(r){const s={"No signer available":"Please check your wallet connection.","User rejected request":"You declined the signature request."}[r.message]||"An unexpected error occurred. Please try again.";N(s)}finally{l.value=!1}};return(r,s)=>{const n=j,u=L;return p(),c("div",z,[o("div",G,[o("div",H,[o("div",R,[o("form",{onSubmit:B(E,["prevent"])},[s[14]||(s[14]=o("div",{class:"modal-header-area d-flex align-items-center justify-content-between"},[o("h4",{class:"text-shadow"},"Log In")],-1)),o("div",Y,[o("div",J,[o("div",Q,[s[3]||(s[3]=o("label",{for:"username"},"Email or Username",-1)),o("div",X,[h(o("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>e(t).username=a),type:"text",class:m(["form-control",{"is-invalid":e(t).errors.has("username")}]),id:"username",placeholder:"Enter email or username or Unique ID"},null,2),[[_,e(t).username]])]),g(n,{form:e(t),field:"username"},null,8,["form"])]),o("div",Z,[s[4]||(s[4]=o("label",{for:"password"},"Password",-1)),o("div",ss,[h(o("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>e(t).password=a),type:"password",class:m([{"is-invalid":e(t).errors.has("password")},"form-control"]),id:"password",placeholder:"Enter valid password"},null,2),[[_,e(t).password]])]),g(n,{form:e(t),field:"password"},null,8,["form"])]),o("div",os,[g(u,{to:"/auth/forgot-password",class:"gradient-color"},{default:U(()=>s[5]||(s[5]=[i("Forgot Password?")])),_:1})]),o("div",es,[o("button",{type:"submit",disabled:e(t).busy,class:"btn1 primary-btn subscribe-btn w-100"},[e(t).busy?(p(),c(x,{key:0},[s[6]||(s[6]=o("i",{class:"fas fa-spinner fa-spin me-1"},null,-1)),s[7]||(s[7]=i(" Processing for "))],64)):f("",!0),s[8]||(s[8]=i(" Login Now ")),s[9]||(s[9]=o("span",{class:"icon-rotate"},[o("i",{class:"fas fa-arrow-right"})],-1))],8,ts)]),s[13]||(s[13]=o("div",{class:"d-flex justify-content-center mt-20 mb20"},[o("p",{class:"modal-or-divider or-divider w-80"},"OR")],-1)),o("div",rs,[o("button",{type:"button",disabled:e(l),onClick:T,class:"btn1 primary-btn subscribe-btn w-100"},[e(l)?(p(),c(x,{key:0},[s[10]||(s[10]=o("i",{class:"fas fa-spinner fa-spin me-1"},null,-1)),s[11]||(s[11]=i(" Processing for "))],64)):f("",!0),i(" "+D(e(A))+" ",1),o("span",{class:m({"icon-rotate":e(d).isConnected})},[o("i",{class:m(["fa-solid",e(d).isConnected?"fa-arrow-right":"fa-wallet"])},null,2)],2)],8,ns)]),e(d).isConnected?(p(),c("div",as,[o("button",{type:"button",onClick:s[2]||(s[2]=(...a)=>e(v)&&e(v)(...a)),class:"btn1 primary-btn subscribe-btn w-100"},s[12]||(s[12]=[i(" Disconnect Wallet "),o("span",{class:"icon-rotate"},[o("i",{class:"fas fa-unlink"})],-1)]))])):f("",!0)])])],32)])])])])}}};export{ws as default};
